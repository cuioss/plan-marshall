[project]
name = "plan-marshall"
version = "0.1.0"
requires-python = ">=3.12"

# =============================================================================
# Pyprojectx Configuration
# =============================================================================

[tool.pyprojectx]
# Lock to specific Python version for consistency
lock-python-version = "3.12"

[tool.pyprojectx.main]
# Dev tools to install
requirements = [
    "uv",
    "pytest>=8.0",
    "pytest-cov>=4.0",
    "pytest-xdist>=3.0",
    "ruff>=0.4",
    "mypy>=1.10",
]

[tool.pyprojectx.aliases]
# Dependency management
install = "uv sync"
lock = "uv lock"
add = "uv add"

# Testing (coverage output goes to .plan/temp/htmlcov/)
test = "uv run pytest test/"
test-cov = ["mkdir -p .plan/temp", "uv run pytest test/ --cov=marketplace --cov-report=html:.plan/temp/htmlcov"]
test-parallel = "uv run pytest test/ -n auto"

# Linting and formatting
lint = "ruff check marketplace/ test/"
lint-fix = "ruff check marketplace/ test/ --fix"
fmt = "ruff format marketplace/ test/"
format = "ruff format marketplace/ test/"

# Type checking
typecheck = "mypy marketplace/"
check = ["@lint", "@typecheck", "@test"]

# Cleanup
clean = "pxrm .venv .pytest_cache .mypy_cache .ruff_cache"

# =============================================================================
# Tool Configurations
# =============================================================================

[tool.pytest.ini_options]
testpaths = ["test"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
norecursedirs = ["fixtures", "__pycache__", ".git"]
addopts = ["-v", "--tb=short"]

[tool.coverage.run]
source = ["marketplace"]
branch = true
omit = ["*/scripts/__pycache__/*"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "if __name__ == .__main__.:",
    "raise NotImplementedError",
]

[tool.ruff]
target-version = "py312"
line-length = 120
src = ["marketplace", "test"]

[tool.ruff.lint]
select = ["E", "W", "F", "I", "B", "C4", "UP"]
ignore = ["E501"]

[tool.ruff.lint.per-file-ignores]
"test/*" = ["B011"]

[tool.ruff.format]
quote-style = "single"

[tool.mypy]
python_version = "3.12"
warn_return_any = true
warn_unused_configs = true
ignore_missing_imports = true
exclude = ["test/"]
