# Analyze Issues Workflow

Post-processing workflow that locates where issues originated using component trace IDs.

## Purpose

After verification identifies **what** failed, this workflow determines **where** (which component) the failure likely originated. Uses component trace IDs (C1, C2, ...) from the trace-components workflow for precise attribution.

## Inputs

- Component trace: `{results_dir}/component-trace.md`
- Structural analysis (if exists): `{results_dir}/structural-analysis.toon`
- Semantic assessment findings from `{results_dir}/assessment-results.toon`

## Output

Creates `{results_dir}/issue-analysis.md` with issue-to-component attributions.

## Step 1: Load Context

Read required files:

```
Read: {results_dir}/component-trace.md
```

If structural analysis exists:
```
Read: {results_dir}/structural-analysis.toon
```

Read semantic findings:
```
Read: {results_dir}/assessment-results.toon
```

## Step 2: Build Invocation Graph

Parse the component trace table to build an invocation graph:

```
C1 (user) → C2 → C3
         → C4 → C5
         → C6 → C7
```

For each component, record:
- Component ID (C1, C2, ...)
- Component type and name
- Parent (what invoked it)
- Children (what it invokes)

## Step 3: Collect All Findings

Gather findings from:

**Structural Analysis** (if exists):
- Each failure record from `failures[]` array
- Already has category and origin suggestion

**Semantic Assessment**:
- Each finding from `findings[]` array
- Category: scope, completeness, quality
- Description and location

## Step 4: Attribute Each Finding

For each finding, trace backwards through the component chain.

### Attribution Heuristics

**Missing Artifact**:
1. Identify which component should create the artifact
2. Trace the invocation chain to that component
3. If component wasn't invoked → origin is the parent that should have called it
4. If component was invoked → origin is the component itself

**Count Mismatch**:
1. Identify which component determines count/scope
2. Check if scope was passed correctly through chain
3. Origin is the component that made the scope decision

**Schema Violation**:
1. Identify which component writes the malformed output
2. Origin is that component

**Scope Mismatch**:
1. Identify where components are selected/filtered
2. Trace config settings through the chain
3. Origin is the component that applied incorrect filtering

**Quality Issues** (from semantic assessment):
1. Trace to component that generated the content
2. Consider upstream components that provided input

### Confidence Assignment

| Confidence | Criteria |
|------------|----------|
| **High** | Single component clearly responsible; direct causal chain |
| **Medium** | Likely origin based on responsibility mapping; some uncertainty |
| **Low** | Multiple possible origins; requires investigation |

## Step 5: Generate Issue Analysis Document

Create structured issue analysis:

```markdown
# Issue Analysis: {test-id}

Generated: {timestamp}

## Issue 1: {finding_description}

**Finding**: {description from verification results}
**Likely Origin**: C{n} ({component_name})
**Confidence**: {high|medium|low}

**Reasoning**:
- {explanation of why this component is the likely origin}
- {trace path through component chain}
- {any relevant context}

**Trace Path**: C1 → C{x} → C{n} → (failure point)

---

## Issue 2: ...

---

## Summary

| Issue | Origin | Confidence | Component |
|-------|--------|------------|-----------|
| {issue_1} | C{n} | {level} | {name} |
| {issue_2} | C{m} | {level} | {name} |
...

## Recommendations

Based on issue analysis:
1. {recommendation_1}
2. {recommendation_2}
...
```

## Step 6: Write Issue Analysis

Store the analysis document:

```
Write: {results_dir}/issue-analysis.md
```

## Example Output

```markdown
# Issue Analysis: migrate-json-to-toon

Generated: 2025-01-19T10:45:00Z

## Issue 1: Missing deliverable in solution outline

**Finding**: Expected 5 deliverables but found 3 in solution_outline.md
**Likely Origin**: C4 (phase-2-outline)
**Confidence**: high

**Reasoning**:
- `solution_outline.md` deliverables are generated by C4 (phase-2-outline)
- C4 was invoked by C1 with request parameters
- The module detection logic in C4 determines which modules get deliverables
- Two modules were not detected, suggesting scope filtering issue in C4

**Trace Path**: C1 → C4 → C5 → (deliverable generation)

---

## Issue 2: Config missing domains field

**Finding**: config.toon does not contain required `domains` field
**Likely Origin**: C2 (phase-1-init)
**Confidence**: high

**Reasoning**:
- `config.toon` is created by C2 (phase-1-init)
- C3 (manage-config script) writes the actual fields
- The `domains` field should be written during init
- Origin is C2 which orchestrates config creation

**Trace Path**: C1 → C2 → C3 → (config write)

---

## Summary

| Issue | Origin | Confidence | Component |
|-------|--------|------------|-----------|
| Missing deliverable | C4 | high | phase-2-outline |
| Config missing domains | C2 | high | phase-1-init |

## Recommendations

Based on issue analysis:
1. Review module detection logic in `phase-2-outline` skill
2. Ensure `phase-1-init` includes domains field in config initialization
```

## Integration

This workflow is called by `test-and-verify.md` as Step V4.5 when findings exist in the assessment results.
