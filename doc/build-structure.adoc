= Build Structure
:toc:

== Overview

This project uses https://pyprojectx.github.io/[Pyprojectx] for Python development tooling, following the Maven/Gradle wrapper pattern.

== Rationale

Pyprojectx was chosen because it provides a proven, mvnw/gradlew-style wrapper for Python that requires only Python 3 on the host system. Unlike custom solutions, it is actively maintained (since 2022), supports multiple tools (uv, ruff, mypy, pytest), and provides reproducible builds via lock files. This approach avoids reinventing the wheel while matching industry best practices for 2025.

== Usage

[source,bash]
----
# Canonical commands with optional module filtering (see build.py)
./pw compile                      # mypy marketplace/bundles/
./pw compile pm-dev-frontend      # mypy single bundle
./pw test-compile                 # mypy test/
./pw test-compile pm-workflow     # mypy single test directory
./pw module-tests                 # pytest test/
./pw module-tests pm-dev-frontend # pytest single directory
./pw quality-gate                 # ruff check all
./pw quality-gate pm-dev-java     # ruff on single bundle + tests
./pw coverage                     # pytest with coverage
./pw verify                       # Full: compile + quality-gate + module-tests
./pw verify pm-dev-frontend       # Full verification on single bundle
./pw clean                        # Remove build artifacts
----

== Project Structure

[source]
----
plan-marshall/
├── pw                 # Unix wrapper (committed)
├── pw.bat             # Windows wrapper (committed)
├── pw.lock            # Tool version lock (committed)
├── build.py           # Build script with module filtering (committed)
├── .pyprojectx/       # Tool installations (gitignored)
├── pyproject.toml     # Configuration
└── test/              # Tests
----

== Configuration

Tool configuration is in `pyproject.toml`:

* `[tool.pyprojectx.main]` - Dev tool requirements (uv, pytest, ruff, mypy)
* `[tool.pyprojectx.aliases]` - Command shortcuts
* `[tool.pytest.ini_options]` - pytest configuration
* `[tool.coverage]` - Coverage settings (output to `.plan/temp/htmlcov/`)
* `[tool.ruff]` - Linter/formatter configuration
* `[tool.mypy]` - Type checker configuration

== Testing

Tests use pytest via the wrapper with optional module filtering:

[source,bash]
----
./pw module-tests                 # pytest test/
./pw module-tests pm-workflow     # pytest test/pm-workflow
./pw module-tests -p              # pytest test/ --parallel
./pw coverage                     # pytest with coverage (to .plan/temp/htmlcov/)
./pw coverage pm-dev-frontend     # coverage for single module
----

=== Test Infrastructure

* `test/conftest.py` - Shared fixtures and utilities
* Fixtures: `fixture_dir`, `plan_context`, `build_context`
* Base class: `ScriptTestCase` for script testing
